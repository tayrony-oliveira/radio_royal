version: "3.9"

services:
  owncast:
    image: owncast/owncast:latest
    ports:
      - "8080:8080"
      - "1935:1935"
    volumes:
      - ./owncast/data:/app/data
      - ./owncast/config:/app/config

  relay:
    build: ./streaming-relay
    ports:
      - "8090:8090"
    environment:
      PORT: "8090"
      RTMP_URL: "rtmp://owncast:1935/live/localdev"
      FFMPEG_PATH: "ffmpeg"
    depends_on:
      - owncast
    volumes:
      - ./streaming-relay:/app
      - relay_node_modules:/app/node_modules

  frontend:
    build: ./frontend
    command: npm run dev -- --host 0.0.0.0 --port 5173
    ports:
      - "5173:5173"
    environment:
      VITE_OWNCAST_WEB_URL: "http://localhost:8080"
      VITE_OWNCAST_HLS_PATH: "/hls/stream.m3u8"
      VITE_RELAY_WS_URL: "ws://localhost:8090"
      VITE_RELAY_HTTP_URL: "http://localhost:8090"
      VITE_ADMIN_PASSWORD: "royal"
    depends_on:
      - relay
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules

volumes:
  relay_node_modules:
  frontend_node_modules:
